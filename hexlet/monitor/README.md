Три таких файла включены: data_1.csv и data_2.csv валидные, а data_3.csv не валидный, с ошибками в структуре данных.

Данные в файле выглядят так:

    1,apples,100,150
    2,tomatos,20,10
Имеется произвольное количество строк, где в каждой строке 4 значения: номер, название товара, его количество и цена.

Пользователь указывает список файлов, из которых нужно прочитать данные. Программа должна прочитать эти файлы, распарсить данные, извлечь название товара и его количество. Данные из всех файлов нужно слить вместе.

Например, если в одном файле у нас:

    1,apples,100,150
    2,tomatos,20,10
а в другом:

    5,apples,120,115
    6,potato,77,52
то результат должен быть:

    #{
    <<"apples">> => 220,
    <<"tomatos">> => 20,
    <<"potato">> => 77
    }
Обработка не всегда бывает успешна. Запрашиваемый файл может отсутствовать, или может быть недоступен, или данные в нем могут не соответствовать требуемому формату. Так что помимо результата программа еще должна сообщить, какие файлы не удалось обработать и почему.

Например:

    {
    #{
    <<"apples">> => 220,
    <<"tomatos">> => 20,
    <<"potato">> => 77
    },
    #{
    <<"data_3.csv">> => some_error,
    <<"data_4.csv">> => other_error,
    }
    }
Можно решить эту задачу одной функцией, с обработкой ошибок с помощью try..catch. Но мы пойдем другим путем -- "Let it crash" и мониторинг потоков.

Модуль main.erl принимает список файлов, для каждого файла запускает отдельный поток и устанавливает на него мониторинг. Потоки выполняются в модуле worker.erl. Каждый из них читает свой файл, парсит данные и посылает родительскому потоку результат. Ошибки не обрабатываются. В любой нештатной ситуации (нет файла, неправильные данные и т.д.) поток просто падает.

Родительский поток получает результаты от рабочих потоков и сливает их в один результат. Он также обрабатывает падения рабочих потоков и сохраняет причины этих падений. И затем возвращает суммарные данные и ошибки.

Смотрите содержимое файлов data_1.csv, data_2.csv, data_3.csv и в main_test.erl смотрите, какие результаты должны быть при обработке этих файлов.